<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How-to: ‡∏™‡∏£‡πâ‡∏≤‡∏á AI Router ‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE ‡∏î‡πâ‡∏ß‡∏¢ n8n</title>
    <style>
        :root {
            --bg-body: #D0D0D0; /* ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏° */
            --bg-card: #EDEDED; /* ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
            --text-main: #333;
            --heading-primary: #2c3e50;
            --heading-secondary: #e67e22; 
            --color-code-inline: #c0392b; 
            --bg-code-block: #2d3436; 
            --text-code-block: #dfe6e9; 
            --border-primary: #ccc;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-main);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-body);
        }
        h1 { color: var(--heading-primary); border-bottom: 2px solid var(--border-primary); padding-bottom: 10px; }
        h2 { color: var(--heading-secondary); margin-top: 35px; border-left: 4px solid var(--heading-secondary); padding-left: 10px; }
        .card {
            background-color: var(--bg-card); 
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        code {
            background-color: #f0f2f5; 
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Consolas", "Monaco", monospace;
            color: var(--color-code-inline);
            font-size: 0.95em;
        }
        pre {
            background-color: var(--bg-code-block); 
            color: var(--text-code-block); 
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 0.9em;
            margin: 15px 0;
            white-space: pre-wrap; /* ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ */
        }
        .step-header {
            font-weight: bold;
            color: var(--heading-primary);
            margin-bottom: 10px;
        }
        .note {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>

    <h1>ü§ñ How-to: ‡∏™‡∏£‡πâ‡∏≤‡∏á AI Router ‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE</h1>
    <p>‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Workflow ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å LINE, ‡πÉ‡∏ä‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏à‡∏ï‡∏ô‡∏≤ (Intent), ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ Python ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Switch) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Sub-workflow ‡∏ï‡πà‡∏≤‡∏á‡πÜ</p>

    <div class="card">
        <h2>1. üü¢ Trigger: ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å LINE</h2>
        <p class="step-header">Node: LINE Messaging Trigger (Webhook)</p>
        <p>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö Events ‡∏à‡∏≤‡∏Å LINE OA ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á AI ‡∏Ñ‡∏∑‡∏≠:</p>
        <ul>
            <li><code>message.type</code> (text, image, location)</li>
            <li><code>message.text</code> (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤)</li>
            <li><code>message.latitude</code> / <code>longitude</code> (‡∏û‡∏¥‡∏Å‡∏±‡∏î)</li>
            <li><code>message.id</code> (‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)</li>
        </ul>
    </div>

    <div class="card">
        <h2>2. üß† AI Agent: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
        <p class="step-header">Node: AI Agent (LangChain) / OpenAI Chat Model</p>
        <p>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Model (‡πÄ‡∏ä‡πà‡∏ô GPT-4o-mini ‡∏´‡∏£‡∏∑‡∏≠ Claude 3.5 Sonnet) ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Prompt ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:</p>
        
        <p><strong>System Prompt (‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å):</strong></p>
        <pre>
Role: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ AI Router ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö n8n ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á User ‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

Categories Definitions:
1. Research (‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢) -> code: "A"
   - ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ User ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ paper, PubMed, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå
   - ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ñ‡∏≤‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î

2. Weather (‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®) -> code: "B"
   - ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ User ‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®, ‡∏ù‡∏ô‡∏ï‡∏Å‡πÑ‡∏´‡∏°
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ô‡∏ö Location

3. Other (‡∏≠‡∏∑‡πà‡∏ô‡πÜ/‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ/‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) -> code: "C"
   - ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ, ‡∏ñ‡∏≤‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß
   - ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πà‡∏≤‡∏¢ A, B, ‡∏´‡∏£‡∏∑‡∏≠ D ‡πÉ‡∏´‡πâ‡∏•‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

4. Image (‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û) -> code: "D"
   - ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Input Type ‡πÄ‡∏õ‡πá‡∏ô "image" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

Output Format (Strict JSON):
{
  "category": "A, B, C, ‡∏´‡∏£‡∏∑‡∏≠ D",
  "text": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á user",
  "latitude": "‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡∏´‡∏£‡∏∑‡∏≠ null",
  "longitude": "‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡∏´‡∏£‡∏∑‡∏≠ null",
  "chatInput": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á user",
  "image_id": "‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ ‡∏´‡∏£‡∏∑‡∏≠ null"
}

‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å: ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà Markdown (```json) ‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°</pre>

        <p><strong>User Message (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤):</strong></p>
        <pre>
Type : {{ $json.message.type }}
User Input: {{ $json.message.text }}
Latitude: {{ $json.message.latitude }}
Longitude: {{ $json.message.longitude }}
Image ID: {{ $json.message.id }}

‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á JSON ‡∏ï‡∏≤‡∏° System Prompt</pre>
    </div>

    <div class="card">
        <h2>3. üêç Code Node: ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå AI ‡πÄ‡∏õ‡πá‡∏ô JSON (Python)</h2>
        <p class="step-header">Node: Code (Python)</p>
        <p>‡πÉ‡∏ä‡πâ Python ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πâ‡∏≤‡∏á Markdown (```json) ‡∏ó‡∏µ‡πà AI ‡∏≠‡∏≤‡∏à‡πÄ‡∏ú‡∏•‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≤ ‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á String ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô JSON Object ‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á</p>
        <pre>
import json
import re

results = []

# ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏∏‡∏Å Item ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å AI Agent
for item in items:
    # 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° String ‡∏ó‡∏µ‡πà AI ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
    # *‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠ field ‡∏Ç‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì* (‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏∑‡∏≠ output ‡∏´‡∏£‡∏∑‡∏≠ text)
    ai_string = item['json'].get('output', '') 

    if not ai_string:
        ai_string = item['json'].get('text', '')

    # 2. ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Clean Up Markdown)
    cleaned_string = re.sub(r'^```json\s*|\s*```$', '', ai_string.strip(), flags=re.MULTILINE)

    try:
        # 3. ‡πÅ‡∏õ‡∏•‡∏á String ‡πÄ‡∏õ‡πá‡∏ô Python Dictionary (JSON Object)
        parsed_data = json.loads(cleaned_string)
        
        # 4. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
        results.append({
            "json": parsed_data
        })
        
    except json.JSONDecodeError as e:
        # ‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á Error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏î‡∏π
        results.append({
            "json": {
                "error": "JSON Parse Error",
                "details": str(e),
                "raw_string": ai_string
            }
        })

return results</pre>
    </div>

    <div class="card">
        <h2>4. üîÄ Switch Node: ‡πÅ‡∏¢‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡∏≤‡∏° Category</h2>
        <p class="step-header">Node: Switch</p>
        <p>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ <strong>Mode: Rules</strong> ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏é‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ <code>{{ $json.category }}</code> ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Node Python</p>
        
        <table border="1" cellpadding="10" cellspacing="0" style="width:100%; border-collapse: collapse; border-color: #ddd;">
            <thead>
                <tr style="background-color: #f0f0f0;">
                    <th>Rule Name</th>
                    <th>Condition (String Match)</th>
                    <th>Value</th>
                    <th>‡πÑ‡∏õ‡∏ó‡∏µ‡πà Node...</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Research</td>
                    <td>Equal to</td>
                    <td><code>A</code></td>
                    <td>Sub-workflow: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ PubMed</td>
                </tr>
                <tr>
                    <td>Weather</td>
                    <td>Equal to</td>
                    <td><code>B</code></td>
                    <td>Sub-workflow: ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</td>
                </tr>
                <tr>
                    <td>General/Other</td>
                    <td>Equal to</td>
                    <td><code>C</code></td>
                    <td>Sub-workflow: ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (LLM)</td>
                </tr>
                <tr>
                    <td>Image</td>
                    <td>Equal to</td>
                    <td><code>D</code></td>
                    <td>Sub-workflow: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Vision)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="card">
        <h2>5. üöÄ Execute Sub-workflow: ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</h2>
        <p class="step-header">Node: Execute Workflow</p>
        <p>‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Output ‡∏Ç‡∏≠‡∏á Switch Node ‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ Node ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Workflow ‡∏¢‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ</p>
        <div class="note">
            <strong>Tip:</strong> ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Sub-workflow ‡∏Ñ‡∏ß‡∏£‡∏™‡πà‡∏á JSON ‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô (text, lat, long, category) ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Workflow ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        </div>
    </div>

</body>
</html>
