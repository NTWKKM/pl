<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏£‡∏∏‡∏õ Workflow: ‡∏Å‡∏£‡∏≠‡∏á PubMed Paper ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (NCBI + n8n)</title>
    <style>
        :root {
            --bg-body: #D0D0D0;
            --bg-card: #EDEDED; 
            --text-main: #333;
            --heading-primary: #2c3e50;
            --heading-secondary: #e67e22; 
            --color-code-inline: #c0392b; 
            --bg-code-block: #2d3436; 
            --text-code-block: #dfe6e9; 
            --border-primary: #ccc;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-main);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-body);
        }
        h1 { color: var(--heading-primary); border-bottom: 2px solid var(--border-primary); padding-bottom: 10px; }
        h2 { color: var(--heading-secondary); margin-top: 35px; border-left: 4px solid var(--heading-secondary); padding-left: 10px; }
        .card {
            background-color: var(--bg-card); 
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        code {
            background-color: #f0f2f5; 
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Consolas", "Monaco", monospace;
            color: var(--color-code-inline);
            font-size: 0.95em;
        }
        pre {
            background-color: var(--bg-code-block); 
            color: var(--text-code-block); 
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: "Consolas", "Monaco", monospace;
            font-size: 0.9em;
            margin: 15px 0;
        }
        .step-header {
            font-weight: bold;
            color: var(--heading-primary);
            margin-bottom: 10px;
        }
        .warning {
            background-color: #fff3cd; 
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <h1>‡∏™‡∏£‡∏∏‡∏õ Workflow: ‡∏Å‡∏£‡∏≠‡∏á PubMed Paper ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h1>
    <p>Workflow ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å 6 ‡∏™‡πà‡∏ß‡∏ô ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Python Code ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• XML ‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>

    <div class="card">
        <h2>1. üéØ E-Search: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ PMIDs</h2>
        <p class="step-header">Node: HTTP Request (GET) </p>
        <p>Endpoint: <code>https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi</code></p>
        
        <p><strong>Query Parameters:</strong></p>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Value</th>
                    <th>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>db</code></td>
                    <td><code>pubmed</code></td>
                    <td>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
                </tr>
                <tr>
                    <td><code>term</code></td>
                    <td><code>emergency medicine</code></td>
                    <td>‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</td>
                </tr>
                <tr>
                    <td><code>mindate</code></td>
                    <td><code>7</code></td>
                    <td>7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</td>
                </tr>
                <tr>
                    <td><code>retmax</code></td>
                    <td><code>100</code></td>
                    <td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</td>
                </tr>
                <tr>
                    <td><code>usehistory</code></td>
                    <td><code>y</code></td>
                    <td></td>
                </tr>
                <tr>
                    <td><code>api_key</code></td>
                    <td><code>&lt;API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì&gt;</code></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <div class="warning">
            <p><strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ‡∏ô‡∏≥ <code>maxdate</code> ‡∏≠‡∏≠‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Format ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</p>
        </div>
    </div>

    <div class="card">
        <h2>2. üêç Python Code #1: ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Key ‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏° PMIDs</h2>
        <p class="step-header">Node: Code (Python) </p>
        <p>‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏î‡∏∂‡∏á‡∏ó‡∏±‡πâ‡∏á <code>QueryKey</code>, <code>WebEnv</code> ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á <code>pmid_list</code> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÅ‡∏ö‡∏ö</p>
        <pre>
import xml.etree.ElementTree as ET
import json

# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 'data' ‡πÄ‡∏õ‡πá‡∏ô 'items' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Input Item ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
# xml_string = data[0]['json']['data'] 
xml_string = items[0]['json']['data']

# 2. ‡πÅ‡∏õ‡∏•‡∏á XML String ‡πÄ‡∏õ‡πá‡∏ô Element Tree (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• XML)
try:
    # .fromstring() ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á String ‡πÄ‡∏õ‡πá‡∏ô Element Tree
    root = ET.fromstring(xml_string)
except Exception as e:
    print(f"XML Parsing Error with ElementTree: {e}")
    return []

# 3. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ QueryKey ‡πÅ‡∏•‡∏∞ WebEnv
try:
    query_key = root.find('QueryKey').text
    web_env = root.find('WebEnv').text
    
    # 4. ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PMIDs ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    id_list_element = root.find('IdList')
    pmid_list_items = []
    
    # ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ text ‡∏Ç‡∏≠‡∏á Element 'Id' ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    for id_element in id_list_element.findall('Id'):
        # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ element ‡∏°‡∏µ text ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô append
        if id_element.text:
            pmid_list_items.append(id_element.text)
        
    # ‡∏£‡∏ß‡∏° PMIDs ‡πÄ‡∏õ‡πá‡∏ô String ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥
    pmid_list = ','.join(pmid_list_items)
    
except AttributeError as e:
    print(f"Error accessing XML element: {e}")
    return []

# 5. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON Object ‡∏ó‡∏µ‡πà n8n ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
# ‡πÉ‡∏ô Python Node ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô List of Dictionaries
return [{
    "query_key": query_key,
    "web_env": web_env,
    "pmid_list": pmid_list 
}]</pre>
    </div>

    <div class="card">
        <h2>3. üöÄ E-Fetch: ‡∏î‡∏∂‡∏á XML Full Record (Medline)</h2>
        <p class="step-header">Node: HTTP Request (GET) </p>
        <p>Endpoint: <code>https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi</code></p>
        <p>Node ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ <strong>id</strong> (PMID List) ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö <strong>WebEnv</strong> ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
        
        <p><strong>Query Parameters:</strong></p>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Value (Expression)</th>
                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>db</code></td>
                    <td><code>pubmed</code></td>
                    <td></td>
                </tr>
                <tr>
                    <td><code>id</code></td>
                    <td><code>{{ $json.pmid_list }}</code></td>
                    <td>‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PMIDs ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</td>
                </tr>
                <tr>
                    <td><code>WebEnv</code></td>
                    <td><code>{{ $json.web_env }}</code></td>
                    <td>‡πÉ‡∏ä‡πâ WebEnv ‡∏£‡πà‡∏ß‡∏°‡∏î‡πâ‡∏ß‡∏¢</td>
                </tr>
                <tr>
                    <td><code>retmode</code></td>
                    <td><code>xml</code></td>
                    <td></td>
                </tr>
                <tr>
                    <td><code>rettype</code></td>
                    <td>(‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ)</td>
                    <td>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ Full XML</td>
                </tr>
                <tr>
                    <td><code>api_key</code></td>
                    <td><code>&lt;API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì&gt;</code></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="card">
        <h2>4. üî™ Python Code #2: ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Title</h2>
        <p class="step-header">Node: Code (Python) </p>
        <p>‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏£‡∏±‡∏ö XML Full Record ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏ß‡πâ‡πÅ‡∏Ñ‡πà <strong>PMID</strong> ‡πÅ‡∏•‡∏∞ <strong>Title</strong></p>
        <pre>
import xml.etree.ElementTree as ET
import json

# ‡∏î‡∏∂‡∏á XML String ‡∏à‡∏≤‡∏Å Output ‡∏Ç‡∏≠‡∏á Node E-Fetch
xml_string = items[0]['json']['data']

try:
    root = ET.fromstring(xml_string)
except Exception as e:
    print(f"E-Fetch XML Parsing Error: {e}")
    return []

results = []

# ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô Tag 'PubmedArticle'
for article in root.findall('PubmedArticle'):
    try:
        # 1. ‡∏î‡∏∂‡∏á PMID
        pmid_element = article.find('.//PMID')
        pmid = pmid_element.text if pmid_element is not None else "N/A"
        
        # 2. ‡∏î‡∏∂‡∏á Title
        title_element = article.find('.//ArticleTitle') 
        title = title_element.text if title_element is not None else "No Title Found"
        
        # 3. ‡∏î‡∏∂‡∏á Abstract (// ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
        # abstract_element = article.find('.//AbstractText')
        # abstract = abstract_element.text if abstract_element is not None else "Abstract Missing"
        
        results.append({
            "PMID": pmid,
            "Title": title,
            # ‡∏•‡∏ö 'Abstract' ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Object ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
            # "Abstract": abstract
        })
    except Exception:
        # ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î Error ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏î ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ
        continue

# ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô List of JSON Objects
return results</pre>
    </div>

    <div class="card">
        <h2>5. üì¶ Aggregate: ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>
        <p class="step-header">Node: Code (Python) ‡∏´‡∏£‡∏∑‡∏≠ Aggregate</p>
        <p>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô <strong>String ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</strong> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏ß‡∏¢ PMID</p>
        <pre>
# ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Node ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (items) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≤‡∏ß‡πÜ
summary_text = "üìë ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:\n\n"

for item in items:
    title = item['json']['Title']
    pmid = item['json']['PMID']
    # ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    summary_text += f"üîπ {title}\nüîó {pmid}\n\n"

# ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 1 Item ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
return [{
    "json": {
        "message": summary_text,
        "count": len(items)
    }
}]</pre>
    </div>

    <div class="card">
        <h2>6. üîî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ AI Agent ‡∏ï‡πà‡∏≠</h2>
        <p class="step-header">Node: LINE Messaging / AI Agent </p>
        <p>‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ <code>{{ $json.message }}</code> ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE ‡∏´‡∏£‡∏∑‡∏≠ AI</p>
    </div>

</body>
</html>
